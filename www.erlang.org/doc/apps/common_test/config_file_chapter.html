<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../../otp_doc.css" type="text/css">
<title>Erlang -- Config Files</title>
</head>
<body bgcolor="white" text="#000000" link="#0000ff" vlink="#ff00ff" alink="#ff0000"><div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../../../../doc/js/erlresolvelinks.js"></script><div id="leftnav"><div class="innertube">
<img alt="Erlang logo" src="../../erlang-logo.png"><br><small>
<a href="users_guide.html">User's Guide</a><br>
<a href="index.html">Reference Manual</a><br>
<a href="release_notes.html">Release Notes</a><br>
<a href="common_test.pdf">PDF</a><br>
<a href="../../index.html">Top</a></small><p><strong>Common Test</strong><br><strong>User's Guide</strong><br><small>Version 1.4.6</small></p>
<br>
<a href="javascript:openAllFlips()">Expand All</a><br>
<a href="javascript:closeAllFlips()">Contract All</a><p><small><strong>Chapters</strong></small></p>
<ul class="flipMenu" imagepath="../../../../doc/js/flipmenu">
<li title="Common Test Basics" expanded="false">Common Test Basics<ul>
<li>
<a href="basics_chapter.html">
              Top of chapter
            </a></li>
<li title="Introduction">
<a href="basics_chapter.html#id2259966">Introduction</a></li>
<li title="Test Suite Organisation">
<a href="basics_chapter.html#id2253168">Test Suite Organisation</a></li>
<li title="Support Libraries">
<a href="basics_chapter.html#id2252019">Support Libraries</a></li>
<li title="Suites and Test Cases">
<a href="basics_chapter.html#id2252025">Suites and Test Cases</a></li>
<li title="External Interfaces">
<a href="basics_chapter.html#id2253081">External Interfaces</a></li>
</ul>
</li>
<li title="Installation" expanded="false">Installation<ul>
<li>
<a href="install_chapter.html">
              Top of chapter
            </a></li>
<li title="General information">
<a href="install_chapter.html#id2260114">General information</a></li>
<li title="Unix/Linux">
<a href="install_chapter.html#id2253924">Unix/Linux</a></li>
<li title="Windows">
<a href="install_chapter.html#id2257012">Windows</a></li>
</ul>
</li>
<li title="Writing Test Suites" expanded="false">Writing Test Suites<ul>
<li>
<a href="write_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Support for test suite authors">
<a href="write_test_chapter.html#id2260181">Support for test suite authors</a></li>
<li title="Test suites">
<a href="write_test_chapter.html#id2260124">Test suites</a></li>
<li title="Init and end per suite">
<a href="write_test_chapter.html#id2259307">Init and end per suite</a></li>
<li title="Init and end per test case">
<a href="write_test_chapter.html#id2253645">Init and end per test case</a></li>
<li title="Test cases">
<a href="write_test_chapter.html#id2262666">Test cases</a></li>
<li title="Test case info function">
<a href="write_test_chapter.html#id2258139">Test case info function</a></li>
<li title="Test suite info function">
<a href="write_test_chapter.html#id2263742">Test suite info function</a></li>
<li title="Test case groups">
<a href="write_test_chapter.html#id2263834">Test case groups</a></li>
<li title="The parallel property and nested groups">
<a href="write_test_chapter.html#id2264105">The parallel property and nested groups</a></li>
<li title="Repeated groups">
<a href="write_test_chapter.html#id2264149">Repeated groups</a></li>
<li title="Shuffled test case order">
<a href="write_test_chapter.html#id2264310">Shuffled test case order</a></li>
<li title="Data and Private Directories">
<a href="write_test_chapter.html#id2264379">Data and Private Directories</a></li>
<li title="Execution environment">
<a href="write_test_chapter.html#id2264458">Execution environment</a></li>
<li title="Illegal dependencies">
<a href="write_test_chapter.html#id2264508">Illegal dependencies</a></li>
</ul>
</li>
<li title="Test Structure" expanded="false">Test Structure<ul>
<li>
<a href="test_structure_chapter.html">
              Top of chapter
            </a></li>
<li title="Test structure">
<a href="test_structure_chapter.html#id2264726">Test structure</a></li>
<li title="Skipping test cases">
<a href="test_structure_chapter.html#id2264743">Skipping test cases</a></li>
<li title="Definition of terms">
<a href="test_structure_chapter.html#id2264827">Definition of terms</a></li>
</ul>
</li>
<li title="Examples and Templates" expanded="false">Examples and Templates<ul>
<li>
<a href="example_chapter.html">
              Top of chapter
            </a></li>
<li title="Test suite example">
<a href="example_chapter.html#id2265696">Test suite example</a></li>
<li title="Test suite templates">
<a href="example_chapter.html#id2265783">Test suite templates</a></li>
</ul>
</li>
<li title="Running Test Suites" expanded="false">Running Test Suites<ul>
<li>
<a href="run_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Using the Common Test Framework">
<a href="run_test_chapter.html#id2266081">Using the Common Test Framework</a></li>
<li title="Automatic compilation of test suites and help modules">
<a href="run_test_chapter.html#id2266125">Automatic compilation of test suites and help modules</a></li>
<li title="Running tests from the UNIX command line">
<a href="run_test_chapter.html#id2266259">Running tests from the UNIX command line</a></li>
<li title="Running tests from the Web based GUI">
<a href="run_test_chapter.html#id2266575">Running tests from the Web based GUI</a></li>
<li title="Running tests from the Erlang shell or from an Erlang program">
<a href="run_test_chapter.html#id2266661">Running tests from the Erlang shell or from an Erlang program</a></li>
<li title="Running the interactive shell mode">
<a href="run_test_chapter.html#id2266717">Running the interactive shell mode</a></li>
<li title="Step by step execution of test cases with the Erlang Debugger">
<a href="run_test_chapter.html#id2266894">Step by step execution of test cases with the Erlang Debugger</a></li>
<li title="Using test specifications">
<a href="run_test_chapter.html#id2266995">Using test specifications</a></li>
<li title="Log files">
<a href="run_test_chapter.html#id2267233">Log files</a></li>
<li title="HTML Style Sheets">
<a href="run_test_chapter.html#id2267439">HTML Style Sheets</a></li>
<li title="Repeating tests">
<a href="run_test_chapter.html#id2267626">Repeating tests</a></li>
<li title="Silent Connections">
<a href="run_test_chapter.html#id2267872">Silent Connections</a></li>
</ul>
</li>
<li title="Config Files" expanded="true">Config Files<ul>
<li>
<a href="config_file_chapter.html">
              Top of chapter
            </a></li>
<li title="General">
<a href="config_file_chapter.html#id2268112">General</a></li>
<li title="Syntax">
<a href="config_file_chapter.html#id2268151">Syntax</a></li>
<li title="Requiring and reading configuration data">
<a href="config_file_chapter.html#id2268175">Requiring and reading configuration data</a></li>
<li title="Using configuration variables defined in multiple files">
<a href="config_file_chapter.html#id2268325">Using configuration variables defined in multiple files</a></li>
<li title="Encrypted configuration files">
<a href="config_file_chapter.html#id2268357">Encrypted configuration files</a></li>
<li title="Opening connections by using configuration data">
<a href="config_file_chapter.html#id2268422">Opening connections by using configuration data</a></li>
<li title="Examples">
<a href="config_file_chapter.html#id2268496">Examples</a></li>
</ul>
</li>
<li title="Code Coverage Analysis" expanded="false">Code Coverage Analysis<ul>
<li>
<a href="cover_chapter.html">
              Top of chapter
            </a></li>
<li title="General">
<a href="cover_chapter.html#id2268615">General</a></li>
<li title="Usage">
<a href="cover_chapter.html#id2268641">Usage</a></li>
<li title="The cover specification file">
<a href="cover_chapter.html#id2268768">The cover specification file</a></li>
<li title="Logging">
<a href="cover_chapter.html#id2268835">Logging</a></li>
</ul>
</li>
<li title="Using Common Test for Large Scale Testing" expanded="false">Using Common Test for Large Scale Testing<ul>
<li>
<a href="ct_master_chapter.html">
              Top of chapter
            </a></li>
<li title="General">
<a href="ct_master_chapter.html#id2268911">General</a></li>
<li title="Usage">
<a href="ct_master_chapter.html#id2268954">Usage</a></li>
<li title="Test Specifications">
<a href="ct_master_chapter.html#id2269112">Test Specifications</a></li>
</ul>
</li>
<li title="Event Handling" expanded="false">Event Handling<ul>
<li>
<a href="event_handler_chapter.html">
              Top of chapter
            </a></li>
<li title="General">
<a href="event_handler_chapter.html#id2269384">General</a></li>
<li title="Usage">
<a href="event_handler_chapter.html#id2269429">Usage</a></li>
</ul>
</li>
<li title="Dependencies between Test Cases and Suites" expanded="false">Dependencies between Test Cases and Suites<ul>
<li>
<a href="dependencies_chapter.html">
              Top of chapter
            </a></li>
<li title="General">
<a href="dependencies_chapter.html#id2270363">General</a></li>
<li title="Saving configuration data">
<a href="dependencies_chapter.html#id2270526">Saving configuration data</a></li>
<li title="Sequences">
<a href="dependencies_chapter.html#id2270719">Sequences</a></li>
</ul>
</li>
<li title="Some thoughts about testing" expanded="false">Some thoughts about testing<ul>
<li>
<a href="why_test_chapter.html">
              Top of chapter
            </a></li>
<li title="Goals">
<a href="why_test_chapter.html#id2270931">Goals</a></li>
<li title="What to test?">
<a href="why_test_chapter.html#id2270956">What to test?</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>7 Config Files</h1>
  
  <h3><a name="id2268112">7.1 
        General</a></h3>
    
    <p>The Common Test framework uses configuration files to
    describe data related to a test and/or an SUT (System Under Test). 
    The configuration data makes it possible to change properties without 
    changing the test program itself. Configuration data can for example be:</p>
    <ul>
      <li>Addresses to the test plant or other instruments</li>
      <li>Filenames for files needed by the test</li>
      <li>Program names for programs that shall be run by the test</li>
      <li>Any other variable that is needed by the test</li>
    </ul>
  
  <h3><a name="id2268151">7.2 
        Syntax</a></h3>
    
    <p>A configuration file can contain any number of elements of the type:</p>
    <div class="example"><pre>
      {Key,Value}.</pre></div>
    <p>where</p>
    <div class="example"><pre>
      Key = atom()
      Value = term() | [{Key,Value}]</pre></div>
  
  <h3><a name="id2268175">7.3 
        Requiring and reading configuration data</a></h3>
    
    <a name="require_config_data"></a>
    <p>In a test suite, one must <strong>require</strong> that a configuration 
    variable exists before attempting to read the associated 
    value in a test case.</p>
    <p><span class="code">require</span> is an assert statement that can be part of the <span class="bold_code">
<a href="write_test_chapter.html#suite">test suite info function</a></span> or
    <span class="bold_code">
<a href="write_test_chapter.html#info_function">test case info
    function</a></span>. If the required variable is not available, the
    test is skipped (unless a default value has been specified, see the
    <span class="bold_code">
<a href="write_test_chapter.html#info_function">test case info
    function</a></span> chapter for details). There is also a function
    <span class="code">ct:require/[1,2]</span> which can be called from a test case
    in order to check if a specific variable is available. The return 
    value from this function must be checked explicitly and appropriate 
    action be taken depending on the result (e.g. to skip the test case
    if the variable in question doesn't exist).</p>
    <p>A <span class="code">require</span> statement in the test suite info- or test case 
    info-list should look like this:
    <span class="code">{require,Required}</span> or <span class="code">{require,Name,Required}</span>. The
    arguments <span class="code">Name</span> and <span class="code">Required</span> are the same as the
    arguments to <span class="code">ct:require/[1,2]</span> which are described in the
    reference manual for <span class="bold_code">
<a href="../../man/ct.html">ct</a></span>.
    <span class="code">Name</span> becomes an alias for the configuration variable
    <span class="code">Required</span>, and can be used as reference to the configuration
    data value. The configuration variable may be associated with an
    arbitrary number of alias names, but each name must be unique within
    the same test suite. There are two main uses for alias names:</p>
    <ul>
      <li>They may be introduced to identify connections (see below).</li>
      <li>They may used to help adapt configuration data to a test suite 
        (or test case) and improve readability.</li>
    </ul>
    <p>To read the value of a config variable, use the function
    <span class="code">get_config/[1,2,3]</span> which is also described in the reference
    manual for <span class="bold_code">
<a href="../../man/ct.html">ct</a></span>.</p>
    <p>Example:</p>
    <div class="example"><pre>
      suite() -&gt; 
          [{require, domain, 'CONN_SPEC_DNS_SUFFIX'}].
      ...
      
      testcase(Config) -&gt;
          Domain = ct:get_config(domain),
	  ...</pre></div>      
  
  <h3><a name="id2268325">7.4 
        Using configuration variables defined in multiple files</a></h3>
  
    <p>If a configuration variable is defined in multiple files and you 
      want to access all possible values, you may use the <span class="code">ct:get_config/3</span>
      function and specify <span class="code">all</span> in the options list. The values will then
      be returned in a list and the order of the elements corresponds to the order 
      that the config files were specified at startup. Please see 
      the <span class="bold_code">
<a href="../../man/ct.html">ct</a></span> reference manual for details.</p>
  
  <h3><a name="id2268357">7.5 
        Encrypted configuration files</a></h3>
    
    <a name="encrypted_config_files"></a>
    <p>It is possible to encrypt configuration files containing sensitive data
      if these files must be stored in open and shared directories.</p> 
      <p>Call <span class="code">ct:encrypt_config_file/[2,3]</span> to have Common Test encrypt a 
      specified file using the DES3 function in the OTP <span class="code">crypto</span> application.
      The encrypted file can then be used as a regular configuration file,
      in combination with other encrypted files or normal text files. The key
      for decrypting the configuration file must be provided when running the test,
      however. This can be done by means of the <span class="code">decrypt_key</span> or
      <span class="code">decrypt_file</span> flag/option, or a key file in a predefined location.</p>
      
      <p>Common Test also provides decryption functions, 
      <span class="code">ct:decrypt_config_file/[2,3]</span>, for recreating the original text
      files.</p> 
      <p>Please see the <span class="bold_code">
<a href="../../man/ct.html">ct</a></span> reference manual for
      more information.</p>
  
  <h3><a name="id2268422">7.6 
        Opening connections by using configuration data</a></h3>
    
    <p>There are two different methods for opening a connection
      by means of the support functions in e.g. <span class="code">ct_ssh</span>, <span class="code">ct_ftp</span>,
      and <span class="code">ct_telnet</span>:</p>
    <ul>
      <li>Using a configuration target name (an alias) as reference.</li>
      <li>Using the configuration variable as reference.</li>
    </ul>    
    <p>When a target name is used for referencing the configuration data
      (that specifies the connection to be opened), the same name may be used 
      as connection identity in all subsequent calls related to the connection
      (also for closing it). It's only possible to have one open connection
      per target name. If attempting to open a new connection using a name
      already associated with an open connection, Common Test will
      return the already existing handle so that the previously opened connection
      will be used. This is a practical feature since it makes it possible to
      call the function for opening a particular connection whenever 
      useful. An action like this will not necessarily open any new 
      connections unless it's required (which could be the case if e.g. the 
      previous connection has been closed unexpectedly by the server).
      Another benefit of using named connections is that it's not
      necessary to pass handle references around in the suite for these 
      connections.
    </p>
    <p>When a configuration variable name is used as reference to the data
      specifying the connection, the handle returned as a result of opening
      the connection must be used in all subsequent calls (also for closing
      the connection). Repeated calls to the open function with the same
      variable name as reference will result in multiple connections
      being opened. This can be useful e.g. if a test case needs to open
      multiple connections to the same server on the target node (using the
      same configuration data for each connection).
    </p>
  
  <h3><a name="id2268496">7.7 
        Examples</a></h3>
    
    <p>A config file for using the FTP client to access files on a remote
      host could look like this:</p>
    <div class="example"><pre>
    {ftp_host, [{ftp,"targethost"},
                {username,"tester"},
	        {password,"letmein"}]}.
    {lm_directory, "/test/loadmodules"}.</pre></div>
    <p>Example of how to assert that the configuration data is available and 
      use it for an FTP session:</p>
    <div class="example"><pre>
    init_per_testcase(ftptest, Config) -&gt;
        {ok,_} = ct_ftp:open(ftp),
	Config.
    end_per_testcase(ftptest, _Config) -&gt;
        ct_ftp:close(ftp).
    ftptest() -&gt;
        [{require,ftp,ftp_host},
	 {require,lm_directory}].
    ftptest(Config) -&gt;
	Remote = filename:join(ct:get_config(lm_directory), "loadmodX"),
        Local = filename:join(?config(priv_dir,Config), "loadmodule"),
        ok = ct_ftp:recv(ftp, Remote, Local),
	...</pre></div>
    
    <p>An example of how the above functions could be rewritten
      if necessary to open multiple connections to the FTP server:</p>
    <div class="example"><pre>
    init_per_testcase(ftptest, Config) -&gt;
        {ok,Handle1} = ct_ftp:open(ftp_host),
        {ok,Handle2} = ct_ftp:open(ftp_host),
	[{ftp_handles,[Handle1,Handle2]} | Config].
    end_per_testcase(ftptest, Config) -&gt;
        lists:foreach(fun(Handle) -&gt; ct_ftp:close(Handle) end, 
                      ?config(ftp_handles,Config)).
    ftptest() -&gt;
        [{require,ftp_host},
	 {require,lm_directory}].
    ftptest(Config) -&gt;
	Remote = filename:join(ct:get_config(lm_directory), "loadmodX"),
        Local = filename:join(?config(priv_dir,Config), "loadmodule"),
        [Handle | MoreHandles] = ?config(ftp_handles,Config),
        ok = ct_ftp:recv(Handle, Remote, Local),
	...</pre></div>
      
  
</div>
<div class="footer">
<hr>
<p>Copyright © 2003-2009 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-3045895-1";
urchinTracker();
</script> 
</body>
</html>
