<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../otp_doc.css" type="text/css">
<title>Erlang -- Distributed Applications</title>
</head>
<body bgcolor="white" text="#000000" link="#0000ff" vlink="#ff00ff" alink="#ff0000"><div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../js/erlresolvelinks.js"></script><div id="leftnav"><div class="innertube">
<img alt="Erlang logo" src="../erlang-logo.png"><br><small>
<a href="users_guide.html">User's Guide</a><br>
<a href="../pdf/otp-system-documentation.pdf">PDF</a><br>
<a href="../index.html">Top</a></small><p><strong>OTP Design Principles</strong><br><strong>User's Guide</strong><br><small>Version 5.7.4</small></p>
<br>
<a href="javascript:openAllFlips()">Expand All</a><br>
<a href="javascript:closeAllFlips()">Contract All</a><p><small><strong>Chapters</strong></small></p>
<ul class="flipMenu" imagepath="../js/flipmenu">
<li title="Overview" expanded="false">Overview<ul>
<li>
<a href="des_princ.html">
              Top of chapter
            </a></li>
<li title="Supervision Trees">
<a href="des_princ.html#id2252268">Supervision Trees</a></li>
<li title="Behaviours">
<a href="des_princ.html#id2258984">Behaviours</a></li>
<li title="Applications">
<a href="des_princ.html#id2252297">Applications</a></li>
<li title="Releases">
<a href="des_princ.html#id2252171">Releases</a></li>
<li title="Release Handling">
<a href="des_princ.html#id2254710">Release Handling</a></li>
</ul>
</li>
<li title="Gen_Server Behaviour" expanded="false">Gen_Server Behaviour<ul>
<li>
<a href="gen_server_concepts.html">
              Top of chapter
            </a></li>
<li title="Client-Server Principles">
<a href="gen_server_concepts.html#id2252090">Client-Server Principles</a></li>
<li title="Example">
<a href="gen_server_concepts.html#id2252110">Example</a></li>
<li title="Starting a Gen_Server">
<a href="gen_server_concepts.html#id2258596">Starting a Gen_Server</a></li>
<li title="Synchronous Requests - Call">
<a href="gen_server_concepts.html#id2267098">Synchronous Requests - Call</a></li>
<li title="Asynchronous Requests - Cast">
<a href="gen_server_concepts.html#id2262742">Asynchronous Requests - Cast</a></li>
<li title="Stopping">
<a href="gen_server_concepts.html#id2264124">Stopping</a></li>
<li title="Handling Other Messages">
<a href="gen_server_concepts.html#id2264230">Handling Other Messages</a></li>
</ul>
</li>
<li title="Gen_Fsm Behaviour" expanded="false">Gen_Fsm Behaviour<ul>
<li>
<a href="fsm.html">
              Top of chapter
            </a></li>
<li title="Finite State Machines">
<a href="fsm.html#id2251340">Finite State Machines</a></li>
<li title="Example">
<a href="fsm.html#id2256726">Example</a></li>
<li title="Starting a Gen_Fsm">
<a href="fsm.html#id2261953">Starting a Gen_Fsm</a></li>
<li title="Notifying About Events">
<a href="fsm.html#id2258488">Notifying About Events</a></li>
<li title="Timeouts">
<a href="fsm.html#id2258580">Timeouts</a></li>
<li title="All State Events">
<a href="fsm.html#id2264981">All State Events</a></li>
<li title="Stopping">
<a href="fsm.html#id2265017">Stopping</a></li>
<li title="Handling Other Messages">
<a href="fsm.html#id2266792">Handling Other Messages</a></li>
</ul>
</li>
<li title="Gen_Event Behaviour" expanded="false">Gen_Event Behaviour<ul>
<li>
<a href="events.html">
              Top of chapter
            </a></li>
<li title="Event Handling Principles">
<a href="events.html#id2267995">Event Handling Principles</a></li>
<li title="Example">
<a href="events.html#id2268056">Example</a></li>
<li title="Starting an Event Manager">
<a href="events.html#id2268104">Starting an Event Manager</a></li>
<li title="Adding an Event Handler">
<a href="events.html#id2268171">Adding an Event Handler</a></li>
<li title="Notifying About Events">
<a href="events.html#id2268262">Notifying About Events</a></li>
<li title="Deleting an Event Handler">
<a href="events.html#id2268339">Deleting an Event Handler</a></li>
<li title="Stopping">
<a href="events.html#id2268420">Stopping</a></li>
</ul>
</li>
<li title="Supervisor Behaviour" expanded="false">Supervisor Behaviour<ul>
<li>
<a href="sup_princ.html">
              Top of chapter
            </a></li>
<li title="Supervision Principles">
<a href="sup_princ.html#id2268545">Supervision Principles</a></li>
<li title="Example">
<a href="sup_princ.html#id2268573">Example</a></li>
<li title="Restart Strategy">
<a href="sup_princ.html#id2268648">Restart Strategy</a></li>
<li title="Maximum Restart Frequency">
<a href="sup_princ.html#id2266142">Maximum Restart Frequency</a></li>
<li title="Child Specification">
<a href="sup_princ.html#id2266207">Child Specification</a></li>
<li title="Starting a Supervisor">
<a href="sup_princ.html#id2266525">Starting a Supervisor</a></li>
<li title="Adding a Child Process">
<a href="sup_princ.html#id2266650">Adding a Child Process</a></li>
<li title="Stopping a Child Process">
<a href="sup_princ.html#id2266699">Stopping a Child Process</a></li>
<li title="Simple-One-For-One Supervisors">
<a href="sup_princ.html#id2268750">Simple-One-For-One Supervisors</a></li>
<li title="Stopping">
<a href="sup_princ.html#id2268847">Stopping</a></li>
</ul>
</li>
<li title="Sys and Proc_Lib" expanded="false">Sys and Proc_Lib<ul>
<li>
<a href="spec_proc.html">
              Top of chapter
            </a></li>
<li title="Simple Debugging">
<a href="spec_proc.html#id2268956">Simple Debugging</a></li>
<li title="Special Processes">
<a href="spec_proc.html#id2269055">Special Processes</a></li>
<li title="User-Defined Behaviours">
<a href="spec_proc.html#id2269737">User-Defined Behaviours</a></li>
</ul>
</li>
<li title="Applications" expanded="false">Applications<ul>
<li>
<a href="applications.html">
              Top of chapter
            </a></li>
<li title="Application Concept">
<a href="applications.html#id2269898">Application Concept</a></li>
<li title="Application Callback Module">
<a href="applications.html#id2269972">Application Callback Module</a></li>
<li title="Application Resource File">
<a href="applications.html#id2270097">Application Resource File</a></li>
<li title="Directory Structure">
<a href="applications.html#id2270364">Directory Structure</a></li>
<li title="Application Controller">
<a href="applications.html#id2270499">Application Controller</a></li>
<li title="Loading and Unloading Applications">
<a href="applications.html#id2270536">Loading and Unloading Applications</a></li>
<li title="Starting and Stopping Applications">
<a href="applications.html#id2270605">Starting and Stopping Applications</a></li>
<li title="Configuring an Application">
<a href="applications.html#id2270704">Configuring an Application</a></li>
<li title="Application Start Types">
<a href="applications.html#id2270920">Application Start Types</a></li>
</ul>
</li>
<li title="Included Applications" expanded="false">Included Applications<ul>
<li>
<a href="included_applications.html">
              Top of chapter
            </a></li>
<li title="Definition">
<a href="included_applications.html#id2271074">Definition</a></li>
<li title="Specifying Included Applications">
<a href="included_applications.html#id2271148">Specifying Included Applications</a></li>
<li title="Synchronizing Processes During Startup">
<a href="included_applications.html#id2271177">Synchronizing Processes During Startup</a></li>
</ul>
</li>
<li title="Distributed Applications" expanded="true">Distributed Applications<ul>
<li>
<a href="distributed_applications.html">
              Top of chapter
            </a></li>
<li title="Definition">
<a href="distributed_applications.html#id2271422">Definition</a></li>
<li title="Specifying Distributed Applications">
<a href="distributed_applications.html#id2271465">Specifying Distributed Applications</a></li>
<li title="Starting and Stopping Distributed Applications">
<a href="distributed_applications.html#id2271692">Starting and Stopping Distributed Applications</a></li>
<li title="Failover">
<a href="distributed_applications.html#id2271804">Failover</a></li>
<li title="Takeover">
<a href="distributed_applications.html#id2271956">Takeover</a></li>
</ul>
</li>
<li title="Releases" expanded="false">Releases<ul>
<li>
<a href="release_structure.html">
              Top of chapter
            </a></li>
<li title="Release Concept">
<a href="release_structure.html#id2272165">Release Concept</a></li>
<li title="Release Resource File">
<a href="release_structure.html#id2272223">Release Resource File</a></li>
<li title="Generating Boot Scripts">
<a href="release_structure.html#id2272372">Generating Boot Scripts</a></li>
<li title="Creating a Release Package">
<a href="release_structure.html#id2272480">Creating a Release Package</a></li>
<li title="Directory Structure">
<a href="release_structure.html#id2272613">Directory Structure</a></li>
</ul>
</li>
<li title="Release Handling" expanded="false">Release Handling<ul>
<li>
<a href="release_handling.html">
              Top of chapter
            </a></li>
<li title="Release Handling Principles">
<a href="release_handling.html#id2272899">Release Handling Principles</a></li>
<li title="Requirements">
<a href="release_handling.html#id2273174">Requirements</a></li>
<li title="Distributed Systems">
<a href="release_handling.html#id2273276">Distributed Systems</a></li>
<li title="Release Handling Instructions">
<a href="release_handling.html#id2273306">Release Handling Instructions</a></li>
<li title="Application Upgrade File">
<a href="release_handling.html#id2273789">Application Upgrade File</a></li>
<li title="Release Upgrade File">
<a href="release_handling.html#id2273992">Release Upgrade File</a></li>
<li title="Installing a Release">
<a href="release_handling.html#id2274164">Installing a Release</a></li>
<li title="Updating Application Specifications">
<a href="release_handling.html#id2274681">Updating Application Specifications</a></li>
</ul>
</li>
<li title="Appup Cookbook" expanded="false">Appup Cookbook<ul>
<li>
<a href="appup_cookbook.html">
              Top of chapter
            </a></li>
<li title="Changing a Functional Module">
<a href="appup_cookbook.html#id2274885">Changing a Functional Module</a></li>
<li title="Changing a Residence Module">
<a href="appup_cookbook.html#id2274910">Changing a Residence Module</a></li>
<li title="Changing a Callback Module">
<a href="appup_cookbook.html#id2274952">Changing a Callback Module</a></li>
<li title="Changing Internal State">
<a href="appup_cookbook.html#id2275007">Changing Internal State</a></li>
<li title="Module Dependencies">
<a href="appup_cookbook.html#id2275158">Module Dependencies</a></li>
<li title="Changing Code For a Special Process">
<a href="appup_cookbook.html#id2275341">Changing Code For a Special Process</a></li>
<li title="Changing a Supervisor">
<a href="appup_cookbook.html#id2275527">Changing a Supervisor</a></li>
<li title="Adding or Deleting a Module">
<a href="appup_cookbook.html#id2275808">Adding or Deleting a Module</a></li>
<li title="Starting or Terminating a Process">
<a href="appup_cookbook.html#id2275834">Starting or Terminating a Process</a></li>
<li title="Adding or Removing an Application">
<a href="appup_cookbook.html#id2275854">Adding or Removing an Application</a></li>
<li title="Restarting an Application">
<a href="appup_cookbook.html#id2275887">Restarting an Application</a></li>
<li title="Changing an Application Specification">
<a href="appup_cookbook.html#id2275933">Changing an Application Specification</a></li>
<li title="Changing Application Configuration">
<a href="appup_cookbook.html#id2275959">Changing Application Configuration</a></li>
<li title="Changing Included Applications">
<a href="appup_cookbook.html#id2275995">Changing Included Applications</a></li>
<li title="Changing Non-Erlang Code">
<a href="appup_cookbook.html#id2276275">Changing Non-Erlang Code</a></li>
<li title="Emulator Restart">
<a href="appup_cookbook.html#id2276372">Emulator Restart</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>9 Distributed Applications</h1>
  
  <h3><a name="id2271422">9.1 
        Definition</a></h3>
    
    <p>In a distributed system with several Erlang nodes, there may be
      a need to control applications in a distributed manner. If
      the node, where a certain application is running, goes down,
      the application should be restarted at another node.</p>
    <p>Such an application is called a <strong>distributed application</strong>.
      Note that it is the control of the application which is
      distributed, all applications can of course be distributed in
      the sense that they, for example, use services on other nodes.</p>
    <p>Because a distributed application may move between nodes, some
      addressing mechanism is required to ensure that it can be
      addressed by other applications, regardless on which node it
      currently executes. This issue is not addressed here, but the
      Kernel module <span class="code">global</span> or STDLIB module <span class="code">pg</span> can be
      used for this purpose.</p>
  
  <h3><a name="id2271465">9.2 
        Specifying Distributed Applications</a></h3>
    
    <p>Distributed applications are controlled by both the application
      controller and a distributed application controller process,
      <span class="code">dist_ac</span>. Both these processes are part of the <span class="code">kernel</span>
      application. Therefore, distributed applications are specified by
      configuring the <span class="code">kernel</span> application, using the following
      configuration parameter (see also <span class="code">kernel(6)</span>):</p>
    <dl>
      <dt><strong><span class="code">distributed = [{Application, [Timeout,] NodeDesc}]</span></strong></dt>
      <dd>
        <p>Specifies where the application <span class="code">Application = atom()</span>
          may execute. <span class="code">NodeDesc = [Node | {Node,...,Node}]</span> is
          a list of node names in priority order. The order between
          nodes in a tuple is undefined.</p>
        <p><span class="code">Timeout = integer()</span> specifies how many milliseconds to
          wait before restarting the application at another node.
          Defaults to 0.</p>
      </dd>
    </dl>
    <p>For distribution of application control to work properly,
      the nodes where a distributed application may run must contact
      each other and negotiate where to start the application. This is
      done using the following <span class="code">kernel</span> configuration parameters:</p>
    <dl>
      <dt><strong><span class="code">sync_nodes_mandatory = [Node]</span></strong></dt>
      <dd>Specifies which other nodes must be started (within
       the timeout specified by <span class="code">sync_nodes_timeout</span>.</dd>
      <dt><strong><span class="code">sync_nodes_optional = [Node]</span></strong></dt>
      <dd>Specifies which other nodes can be started (within
       the timeout specified by <span class="code">sync_nodes_timeout</span>.</dd>
      <dt><strong><span class="code">sync_nodes_timeout = integer() | infinity</span></strong></dt>
      <dd>Specifies how many milliseconds to wait for the other nodes
       to start.</dd>
    </dl>
    <p>When started, the node will wait for all nodes specified by
      <span class="code">sync_nodes_mandatory</span> and <span class="code">sync_nodes_optional</span> to
      come up. When all nodes have come up, or when all mandatory nodes
      have come up and the time specified by <span class="code">sync_nodes_timeout</span>
      has elapsed, all applications will be started. If not all
      mandatory nodes have come up, the node will terminate.</p>
    <p>Example: An application <span class="code">myapp</span> should run at the node
      <span class="code">cp1@cave</span>. If this node goes down, <span class="code">myapp</span> should
      be restarted at <span class="code">cp2@cave</span> or <span class="code">cp3@cave</span>. A system
      configuration file <span class="code">cp1.config</span> for <span class="code">cp1@cave</span> could
      look like:</p>
    <div class="example"><pre>
[{kernel,
  [{distributed, [{myapp, 5000, [cp1@cave, {cp2@cave, cp3@cave}]}]},
   {sync_nodes_mandatory, [cp2@cave, cp3@cave]},
   {sync_nodes_timeout, 5000}
  ]
 }
].</pre></div>
    <p>The system configuration files for <span class="code">cp2@cave</span> and
      <span class="code">cp3@cave</span> are identical, except for the list of mandatory
      nodes which should be <span class="code">[cp1@cave, cp3@cave]</span> for
      <span class="code">cp2@cave</span> and <span class="code">[cp1@cave, cp2@cave]</span> for
      <span class="code">cp3@cave</span>.</p>
    <div class="note">
<div class="label">Note</div>
<div class="content"><p>
      <p>All involved nodes must have the same value for
        <span class="code">distributed</span> and <span class="code">sync_nodes_timeout</span>, or
        the behaviour of the system is undefined.</p>
    </p></div>
</div>
  
  <h3><a name="id2271692">9.3 
        Starting and Stopping Distributed Applications</a></h3>
    
    <p>When all involved (mandatory) nodes have been started,
      the distributed application can be started by calling
      <span class="code">application:start(Application)</span> at <strong>all of these nodes.</strong></p>
    <p>It is of course also possible to use a boot script (see
      <span class="bold_code">
<a href="release_structure.html">Releases</a></span>) which
      automatically starts the application.</p>
    <p>The application will be started at the first node, specified
      by the <span class="code">distributed</span> configuration parameter, which is up
      and running. The application is started as usual. That is, an
      application master is created and calls the application callback
      function:</p>
    <div class="example"><pre>
Module:start(normal, StartArgs)</pre></div>
    <p>Example: Continuing the example from the previous section,
      the three nodes are started, specifying the system configuration
      file:</p>
    <div class="example"><pre>
&gt; <span class="bold_code">erl -sname cp1 -config cp1</span>
&gt; <span class="bold_code">erl -sname cp2 -config cp2</span>
&gt; <span class="bold_code">erl -sname cp3 -config cp3</span></pre></div>
    <p>When all nodes are up and running, <span class="code">myapp</span> can be started.
      This is achieved by calling <span class="code">application:start(myapp)</span> at
      all three nodes. It is then started at <span class="code">cp1</span>, as shown in
      the figure below.</p>
    <a name="dist1"></a>
    <img alt="IMAGE MISSING" src="../design_principles/dist1.gif"><br>
      <em>Figure
        9.1:
         
        Application myapp - Situation 1</em>
    
    <p>Similarly, the application must be stopped by calling
      <span class="code">application:stop(Application)</span> at all involved nodes.</p>
  
  <h3><a name="id2271804">9.4 
        Failover</a></h3>
    
    <p>If the node where the application is running goes down,
      the application is restarted (after the specified timeout) at
      the first node, specified by the <span class="code">distributed</span> configuration
      parameter, which is up and running. This is called a
      <strong>failover</strong>.</p>
    <p>The application is started the normal way at the new node,
      that is, by the application master calling:</p>
    <div class="example"><pre>
Module:start(normal, StartArgs)</pre></div>
    <p>Exception: If the application has the <span class="code">start_phases</span> key
      defined (see <span class="bold_code">
<a href="included_applications.html">Included Applications</a></span>), then the application is instead started
      by calling:</p>
    <div class="example"><pre>
Module:start({failover, Node}, StartArgs)</pre></div>
    <p>where <span class="code">Node</span> is the terminated node.</p>
    <p>Example: If <span class="code">cp1</span> goes down, the system checks which one of
      the other nodes, <span class="code">cp2</span> or <span class="code">cp3</span>, has the least number of
      running applications, but waits for 5 seconds for <span class="code">cp1</span> to
      restart. If <span class="code">cp1</span> does not restart and <span class="code">cp2</span> runs fewer
      applications than <span class="code">cp3,</span> then <span class="code">myapp</span> is restarted on
      <span class="code">cp2</span>.</p>
    <a name="dist2"></a>
    <img alt="IMAGE MISSING" src="../design_principles/dist2.gif"><br>
      <em>Figure
        9.2:
         
        Application myapp - Situation 2</em>
    
    <p>Suppose now that <span class="code">cp2</span> goes down as well and does not
      restart within 5 seconds. <span class="code">myapp</span> is now restarted on
      <span class="code">cp3</span>.</p>
    <a name="dist3"></a>
    <img alt="IMAGE MISSING" src="../design_principles/dist3.gif"><br>
      <em>Figure
        9.3:
         
        Application myapp - Situation 3</em>
    
  
  <h3><a name="id2271956">9.5 
        Takeover</a></h3>
    
    <p>If a node is started, which has higher priority according
      to <span class="code">distributed</span>, than the node where a distributed
      application is currently running, the application will be
      restarted at the new node and stopped at the old node. This is
      called a <strong>takeover</strong>.</p>
    <p>The application is started by the application master calling:</p>
    <div class="example"><pre>
Module:start({takeover, Node}, StartArgs)</pre></div>
    <p>where <span class="code">Node</span> is the old node.</p>
    <p>Example: If <span class="code">myapp</span> is running at <span class="code">cp3</span>, and if
      <span class="code">cp2</span> now restarts, it will not restart <span class="code">myapp</span>,
      because the order between nodes <span class="code">cp2</span> and <span class="code">cp3</span> is
      undefined.</p>
    <a name="dist4"></a>
    <img alt="IMAGE MISSING" src="../design_principles/dist4.gif"><br>
      <em>Figure
        9.4:
         
        Application myapp - Situation 4</em>
    
    <p>However, if <span class="code">cp1</span> restarts as well, the function
      <span class="code">application:takeover/2</span> moves <span class="code">myapp</span> to <span class="code">cp1</span>,
      because <span class="code">cp1</span> has a higher priority than <span class="code">cp3</span> for this
      application.  In this case,
      <span class="code">Module:start({takeover, cp3@cave}, StartArgs)</span> is executed
      at <span class="code">cp1</span> to start the application.</p>
    <a name="dist5"></a>
    <img alt="IMAGE MISSING" src="../design_principles/dist5.gif"><br>
      <em>Figure
        9.5:
         
        Application myapp - Situation 5</em>
    
  
</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2009 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-3045895-1";
urchinTracker();
</script> 
</body>
</html>
