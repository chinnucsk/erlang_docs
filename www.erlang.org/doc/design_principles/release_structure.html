<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../otp_doc.css" type="text/css">
<title>Erlang -- Releases</title>
</head>
<body bgcolor="white" text="#000000" link="#0000ff" vlink="#ff00ff" alink="#ff0000"><div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../js/erlresolvelinks.js"></script><div id="leftnav"><div class="innertube">
<img alt="Erlang logo" src="../erlang-logo.png"><br><small>
<a href="users_guide.html">User's Guide</a><br>
<a href="../pdf/otp-system-documentation.pdf">PDF</a><br>
<a href="../index.html">Top</a></small><p><strong>OTP Design Principles</strong><br><strong>User's Guide</strong><br><small>Version 5.7.4</small></p>
<br>
<a href="javascript:openAllFlips()">Expand All</a><br>
<a href="javascript:closeAllFlips()">Contract All</a><p><small><strong>Chapters</strong></small></p>
<ul class="flipMenu" imagepath="../js/flipmenu">
<li title="Overview" expanded="false">Overview<ul>
<li>
<a href="des_princ.html">
              Top of chapter
            </a></li>
<li title="Supervision Trees">
<a href="des_princ.html#id2252268">Supervision Trees</a></li>
<li title="Behaviours">
<a href="des_princ.html#id2258984">Behaviours</a></li>
<li title="Applications">
<a href="des_princ.html#id2252297">Applications</a></li>
<li title="Releases">
<a href="des_princ.html#id2252171">Releases</a></li>
<li title="Release Handling">
<a href="des_princ.html#id2254710">Release Handling</a></li>
</ul>
</li>
<li title="Gen_Server Behaviour" expanded="false">Gen_Server Behaviour<ul>
<li>
<a href="gen_server_concepts.html">
              Top of chapter
            </a></li>
<li title="Client-Server Principles">
<a href="gen_server_concepts.html#id2252090">Client-Server Principles</a></li>
<li title="Example">
<a href="gen_server_concepts.html#id2252110">Example</a></li>
<li title="Starting a Gen_Server">
<a href="gen_server_concepts.html#id2258596">Starting a Gen_Server</a></li>
<li title="Synchronous Requests - Call">
<a href="gen_server_concepts.html#id2267098">Synchronous Requests - Call</a></li>
<li title="Asynchronous Requests - Cast">
<a href="gen_server_concepts.html#id2262742">Asynchronous Requests - Cast</a></li>
<li title="Stopping">
<a href="gen_server_concepts.html#id2264124">Stopping</a></li>
<li title="Handling Other Messages">
<a href="gen_server_concepts.html#id2264230">Handling Other Messages</a></li>
</ul>
</li>
<li title="Gen_Fsm Behaviour" expanded="false">Gen_Fsm Behaviour<ul>
<li>
<a href="fsm.html">
              Top of chapter
            </a></li>
<li title="Finite State Machines">
<a href="fsm.html#id2251340">Finite State Machines</a></li>
<li title="Example">
<a href="fsm.html#id2256726">Example</a></li>
<li title="Starting a Gen_Fsm">
<a href="fsm.html#id2261953">Starting a Gen_Fsm</a></li>
<li title="Notifying About Events">
<a href="fsm.html#id2258488">Notifying About Events</a></li>
<li title="Timeouts">
<a href="fsm.html#id2258580">Timeouts</a></li>
<li title="All State Events">
<a href="fsm.html#id2264981">All State Events</a></li>
<li title="Stopping">
<a href="fsm.html#id2265017">Stopping</a></li>
<li title="Handling Other Messages">
<a href="fsm.html#id2266792">Handling Other Messages</a></li>
</ul>
</li>
<li title="Gen_Event Behaviour" expanded="false">Gen_Event Behaviour<ul>
<li>
<a href="events.html">
              Top of chapter
            </a></li>
<li title="Event Handling Principles">
<a href="events.html#id2267995">Event Handling Principles</a></li>
<li title="Example">
<a href="events.html#id2268056">Example</a></li>
<li title="Starting an Event Manager">
<a href="events.html#id2268104">Starting an Event Manager</a></li>
<li title="Adding an Event Handler">
<a href="events.html#id2268171">Adding an Event Handler</a></li>
<li title="Notifying About Events">
<a href="events.html#id2268262">Notifying About Events</a></li>
<li title="Deleting an Event Handler">
<a href="events.html#id2268339">Deleting an Event Handler</a></li>
<li title="Stopping">
<a href="events.html#id2268420">Stopping</a></li>
</ul>
</li>
<li title="Supervisor Behaviour" expanded="false">Supervisor Behaviour<ul>
<li>
<a href="sup_princ.html">
              Top of chapter
            </a></li>
<li title="Supervision Principles">
<a href="sup_princ.html#id2268545">Supervision Principles</a></li>
<li title="Example">
<a href="sup_princ.html#id2268573">Example</a></li>
<li title="Restart Strategy">
<a href="sup_princ.html#id2268648">Restart Strategy</a></li>
<li title="Maximum Restart Frequency">
<a href="sup_princ.html#id2266142">Maximum Restart Frequency</a></li>
<li title="Child Specification">
<a href="sup_princ.html#id2266207">Child Specification</a></li>
<li title="Starting a Supervisor">
<a href="sup_princ.html#id2266525">Starting a Supervisor</a></li>
<li title="Adding a Child Process">
<a href="sup_princ.html#id2266650">Adding a Child Process</a></li>
<li title="Stopping a Child Process">
<a href="sup_princ.html#id2266699">Stopping a Child Process</a></li>
<li title="Simple-One-For-One Supervisors">
<a href="sup_princ.html#id2268750">Simple-One-For-One Supervisors</a></li>
<li title="Stopping">
<a href="sup_princ.html#id2268847">Stopping</a></li>
</ul>
</li>
<li title="Sys and Proc_Lib" expanded="false">Sys and Proc_Lib<ul>
<li>
<a href="spec_proc.html">
              Top of chapter
            </a></li>
<li title="Simple Debugging">
<a href="spec_proc.html#id2268956">Simple Debugging</a></li>
<li title="Special Processes">
<a href="spec_proc.html#id2269055">Special Processes</a></li>
<li title="User-Defined Behaviours">
<a href="spec_proc.html#id2269737">User-Defined Behaviours</a></li>
</ul>
</li>
<li title="Applications" expanded="false">Applications<ul>
<li>
<a href="applications.html">
              Top of chapter
            </a></li>
<li title="Application Concept">
<a href="applications.html#id2269898">Application Concept</a></li>
<li title="Application Callback Module">
<a href="applications.html#id2269972">Application Callback Module</a></li>
<li title="Application Resource File">
<a href="applications.html#id2270097">Application Resource File</a></li>
<li title="Directory Structure">
<a href="applications.html#id2270364">Directory Structure</a></li>
<li title="Application Controller">
<a href="applications.html#id2270499">Application Controller</a></li>
<li title="Loading and Unloading Applications">
<a href="applications.html#id2270536">Loading and Unloading Applications</a></li>
<li title="Starting and Stopping Applications">
<a href="applications.html#id2270605">Starting and Stopping Applications</a></li>
<li title="Configuring an Application">
<a href="applications.html#id2270704">Configuring an Application</a></li>
<li title="Application Start Types">
<a href="applications.html#id2270920">Application Start Types</a></li>
</ul>
</li>
<li title="Included Applications" expanded="false">Included Applications<ul>
<li>
<a href="included_applications.html">
              Top of chapter
            </a></li>
<li title="Definition">
<a href="included_applications.html#id2271074">Definition</a></li>
<li title="Specifying Included Applications">
<a href="included_applications.html#id2271148">Specifying Included Applications</a></li>
<li title="Synchronizing Processes During Startup">
<a href="included_applications.html#id2271177">Synchronizing Processes During Startup</a></li>
</ul>
</li>
<li title="Distributed Applications" expanded="false">Distributed Applications<ul>
<li>
<a href="distributed_applications.html">
              Top of chapter
            </a></li>
<li title="Definition">
<a href="distributed_applications.html#id2271422">Definition</a></li>
<li title="Specifying Distributed Applications">
<a href="distributed_applications.html#id2271465">Specifying Distributed Applications</a></li>
<li title="Starting and Stopping Distributed Applications">
<a href="distributed_applications.html#id2271692">Starting and Stopping Distributed Applications</a></li>
<li title="Failover">
<a href="distributed_applications.html#id2271804">Failover</a></li>
<li title="Takeover">
<a href="distributed_applications.html#id2271956">Takeover</a></li>
</ul>
</li>
<li title="Releases" expanded="true">Releases<ul>
<li>
<a href="release_structure.html">
              Top of chapter
            </a></li>
<li title="Release Concept">
<a href="release_structure.html#id2272165">Release Concept</a></li>
<li title="Release Resource File">
<a href="release_structure.html#id2272223">Release Resource File</a></li>
<li title="Generating Boot Scripts">
<a href="release_structure.html#id2272372">Generating Boot Scripts</a></li>
<li title="Creating a Release Package">
<a href="release_structure.html#id2272480">Creating a Release Package</a></li>
<li title="Directory Structure">
<a href="release_structure.html#id2272613">Directory Structure</a></li>
</ul>
</li>
<li title="Release Handling" expanded="false">Release Handling<ul>
<li>
<a href="release_handling.html">
              Top of chapter
            </a></li>
<li title="Release Handling Principles">
<a href="release_handling.html#id2272899">Release Handling Principles</a></li>
<li title="Requirements">
<a href="release_handling.html#id2273174">Requirements</a></li>
<li title="Distributed Systems">
<a href="release_handling.html#id2273276">Distributed Systems</a></li>
<li title="Release Handling Instructions">
<a href="release_handling.html#id2273306">Release Handling Instructions</a></li>
<li title="Application Upgrade File">
<a href="release_handling.html#id2273789">Application Upgrade File</a></li>
<li title="Release Upgrade File">
<a href="release_handling.html#id2273992">Release Upgrade File</a></li>
<li title="Installing a Release">
<a href="release_handling.html#id2274164">Installing a Release</a></li>
<li title="Updating Application Specifications">
<a href="release_handling.html#id2274681">Updating Application Specifications</a></li>
</ul>
</li>
<li title="Appup Cookbook" expanded="false">Appup Cookbook<ul>
<li>
<a href="appup_cookbook.html">
              Top of chapter
            </a></li>
<li title="Changing a Functional Module">
<a href="appup_cookbook.html#id2274885">Changing a Functional Module</a></li>
<li title="Changing a Residence Module">
<a href="appup_cookbook.html#id2274910">Changing a Residence Module</a></li>
<li title="Changing a Callback Module">
<a href="appup_cookbook.html#id2274952">Changing a Callback Module</a></li>
<li title="Changing Internal State">
<a href="appup_cookbook.html#id2275007">Changing Internal State</a></li>
<li title="Module Dependencies">
<a href="appup_cookbook.html#id2275158">Module Dependencies</a></li>
<li title="Changing Code For a Special Process">
<a href="appup_cookbook.html#id2275341">Changing Code For a Special Process</a></li>
<li title="Changing a Supervisor">
<a href="appup_cookbook.html#id2275527">Changing a Supervisor</a></li>
<li title="Adding or Deleting a Module">
<a href="appup_cookbook.html#id2275808">Adding or Deleting a Module</a></li>
<li title="Starting or Terminating a Process">
<a href="appup_cookbook.html#id2275834">Starting or Terminating a Process</a></li>
<li title="Adding or Removing an Application">
<a href="appup_cookbook.html#id2275854">Adding or Removing an Application</a></li>
<li title="Restarting an Application">
<a href="appup_cookbook.html#id2275887">Restarting an Application</a></li>
<li title="Changing an Application Specification">
<a href="appup_cookbook.html#id2275933">Changing an Application Specification</a></li>
<li title="Changing Application Configuration">
<a href="appup_cookbook.html#id2275959">Changing Application Configuration</a></li>
<li title="Changing Included Applications">
<a href="appup_cookbook.html#id2275995">Changing Included Applications</a></li>
<li title="Changing Non-Erlang Code">
<a href="appup_cookbook.html#id2276275">Changing Non-Erlang Code</a></li>
<li title="Emulator Restart">
<a href="appup_cookbook.html#id2276372">Emulator Restart</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>10 Releases</h1>
  
  <p>This chapter should be read in conjuction with <span class="code">rel(4)</span>,
    <span class="code">systools(3)</span> and <span class="code">script(4)</span>.</p>
  <h3><a name="id2272165">10.1 
        Release Concept</a></h3>
    
    <p>When we have written one or more applications, we might want to
      create a complete system consisting of these applications and a
      subset of the Erlang/OTP applications. This is called a
      <strong>release</strong>.</p>
    <p>To do this, we create a <span class="bold_code">
<a href="#res_file">release resource file</a></span> which defines which applications
      are included in the release.</p>
    <p>The release resource file is used to generate
      <span class="bold_code">
<a href="#boot">boot scripts</a></span> and
      <span class="bold_code">
<a href="#pack">release packages</a></span>. A system
      which is transfered to and installed at another site is called a
      <strong>target system</strong>. How to use a release package to create a
      target system is described in System Principles.</p>
  
  <h3><a name="id2272223">10.2 
        Release Resource File</a></h3>
    <a name="res_file"></a>
    
    <p>To define a release, we create a <strong>release resource file</strong>,
      or in short <span class="code">.rel</span> file, where we specify the name and
      version of the release, which ERTS version it is based on, and
      which applications it consists of:</p>
    <div class="example"><pre>
{release, {Name,Vsn}, {erts, EVsn},
 [{Application1, AppVsn1},
   ...
  {ApplicationN, AppVsnN}]}.</pre></div>
    <p>The file must be named <span class="code">Rel.rel</span>, where <span class="code">Rel</span> is a
      unique name.</p>
    <p><span class="code">Name</span>, <span class="code">Vsn</span> and <span class="code">Evsn</span> are strings.</p>
    <p>Each <span class="code">Application</span> (atom) and <span class="code">AppVsn</span> (string) is
      the name and version of an application included in the release.
      Note the the minimal release based on Erlang/OTP consists of
      the <span class="code">kernel</span> and <span class="code">stdlib</span> applications, so these
      applications must be included in the list.</p>
    <a name="ch_rel"></a>
    <p>Example: We want to make a release of <span class="code">ch_app</span> from
      the <span class="bold_code">
<a href="applications.html#ch_app">Applications</a></span>
      chapter. It has the following <span class="code">.app</span> file:</p>
    <div class="example"><pre>
{application, ch_app,
 [{description, "Channel allocator"},
  {vsn, "1"},
  {modules, [ch_app, ch_sup, ch3]},
  {registered, [ch3]},
  {applications, [kernel, stdlib, sasl]},
  {mod, {ch_app,[]}}
 ]}.</pre></div>
    <p>The <span class="code">.rel</span> file must also contain <span class="code">kernel</span>,
      <span class="code">stdlib</span> and <span class="code">sasl</span>, since these applications are
      required by <span class="code">ch_app</span>. We call the file <span class="code">ch_rel-1.rel</span>:</p>
    <div class="example"><pre>
{release,
 {"ch_rel", "A"},
 {erts, "5.3"},
 [{kernel, "2.9"},
  {stdlib, "1.12"},
  {sasl, "1.10"},
  {ch_app, "1"}]
}.</pre></div>
  
  <h3><a name="id2272372">10.3 
        Generating Boot Scripts</a></h3>
    <a name="boot"></a>
    
    <p>There are tools in the SASL module <span class="code">systools</span> available to
      build and check releases. The functions read the <span class="code">.rel</span> and
      <span class="code">.app</span> files and performs syntax and dependency checks.
      The function <span class="code">systools:make_script/1,2</span> is used to generate
      a boot script (see System Principles).</p>
    <div class="example"><pre>
1&gt; <span class="bold_code">systools:make_script("ch_rel-1", [local]).</span>
ok</pre></div>
    <p>This creates a boot script, both the readable version
      <span class="code">ch_rel-1.script</span> and the binary version used by the runtime
      system, <span class="code">ch_rel-1.boot</span>. <span class="code">"ch_rel-1"</span> is the name of
      the <span class="code">.rel</span> file, minus the extension. <span class="code">local</span> is an
      option that means that the directories where the applications are
      found are used in the boot script, instead of <span class="code">$ROOT/lib</span>.
      (<span class="code">$ROOT</span> is the root directory of the installed release.)
      This is a useful way to test a generated boot script locally.</p>
    <p>When starting Erlang/OTP using the boot script, all applications
      from the <span class="code">.rel</span> file are automatically loaded and started:</p>
    <div class="example"><pre>
% <span class="bold_code">erl -boot ch_rel-1</span>
Erlang (BEAM) emulator version 5.3
Eshell V5.3  (abort with ^G)
1&gt; 
=PROGRESS REPORT==== 13-Jun-2003::12:01:15 ===
          supervisor: {local,sasl_safe_sup}
             started: [{pid,&lt;0.33.0&gt;},
                       {name,alarm_handler},
                       {mfa,{alarm_handler,start_link,[]}},
                       {restart_type,permanent},
                       {shutdown,2000},
                       {child_type,worker}]
...
=PROGRESS REPORT==== 13-Jun-2003::12:01:15 ===
         application: sasl
          started_at: nonode@nohost
...
=PROGRESS REPORT==== 13-Jun-2003::12:01:15 ===
         application: ch_app
          started_at: nonode@nohost</pre></div>
  
  <h3><a name="id2272480">10.4 
        Creating a Release Package</a></h3>
    <a name="pack"></a>
    
    <p>There is a function <span class="code">systools:make_tar/1,2</span> which takes
      a <span class="code">.rel</span> file as input and creates a zipped tar-file with
      the code for the specified applications, a <strong>release package</strong>.</p>
    <div class="example"><pre>
1&gt; <span class="bold_code">systools:make_script("ch_rel-1").</span>
ok
2&gt; <span class="bold_code">systools:make_tar("ch_rel-1").</span>
ok</pre></div>
    <p>The release package by default contains the <span class="code">.app</span> files and
      object code for all applications, structured according to
      the <span class="bold_code">
<a href="applications.html#app_dir">application directory structure</a></span>, the binary boot script renamed to
      <span class="code">start.boot</span>, and the <span class="code">.rel</span> file.</p>
    <div class="example"><pre>
% <span class="bold_code">tar tf ch_rel-1.tar</span>
lib/kernel-2.9/ebin/kernel.app
lib/kernel-2.9/ebin/application.beam
...
lib/stdlib-1.12/ebin/stdlib.app
lib/stdlib-1.12/ebin/beam_lib.beam
...
lib/sasl-1.10/ebin/sasl.app
lib/sasl-1.10/ebin/sasl.beam
...
lib/ch_app-1/ebin/ch_app.app
lib/ch_app-1/ebin/ch_app.beam
lib/ch_app-1/ebin/ch_sup.beam
lib/ch_app-1/ebin/ch3.beam
releases/A/start.boot
releases/ch_rel-1.rel</pre></div>
    <p>Note that a new boot script was generated, without
      the <span class="code">local</span> option set, before the release package was made.
      In the release package, all application directories are placed
      under <span class="code">lib</span>. Also, we do not know where the release package
      will be installed, so we do not want any hardcoded absolute paths
      in the boot script here.</p>
    <p>If a <span class="code">relup</span> file and/or a system configuration file called
      <span class="code">sys.config</span> is found, these files are included in
      the release package as well. See
      <span class="bold_code">
<a href="release_handling.html#req">Release Handling</a></span>.</p>
    <p>Options can be set to make the release package include source
      code and the ERTS binary as well.</p>
    <p>Refer to System Principles for how to install the first target
      system, using a release package, and to
      <span class="bold_code">
<a href="release_handling.html">Release Handling</a></span> for
      how to install a new release package in an existing system.</p>
  
  <h3><a name="id2272613">10.5 
        Directory Structure</a></h3>
    <a name="reldir"></a>
    
    <p>Directory structure for the code installed by the release handler
      from a release package:</p>
    <div class="example"><pre>
$ROOT/lib/App1-AVsn1/ebin
                    /priv
         /App2-AVsn2/ebin
                    /priv
         ...
         /AppN-AVsnN/ebin
                    /priv
     /erts-EVsn/bin
     /releases/Vsn
     /bin</pre></div>
    <dl>
      <dt><strong><span class="code">lib</span></strong></dt>
      <dd>Application directories.</dd>
      <dt><strong><span class="code">erts-EVsn/bin</span></strong></dt>
      <dd>Erlang runtime system executables.</dd>
      <dt><strong><span class="code">releases/Vsn</span></strong></dt>
      <dd>
<span class="code">.rel</span> file and boot script <span class="code">start.boot</span>.      <br>
       If present in the release package,      <br>
<span class="code">relup</span> and/or <span class="code">sys.config</span>.</dd>
      <dt><strong><span class="code">bin</span></strong></dt>
      <dd>Top level Erlang runtime system executables.</dd>
    </dl>
    <p>Applications are not required to be located under the
      <span class="code">$ROOT/lib</span> directory. Accordingly, several installation
      directories may exist which contain different parts of a
      system. For example, the previous example could be extended as
      follows:</p>
    <div class="example"><pre>
$SECOND_ROOT/.../SApp1-SAVsn1/ebin
                             /priv
                /SApp2-SAVsn2/ebin
                             /priv
                ...
                /SAppN-SAVsnN/ebin
                             /priv
$THIRD_ROOT/TApp1-TAVsn1/ebin
                        /priv
           /TApp2-TAVsn2/ebin
                        /priv
           ...
           /TAppN-TAVsnN/ebin
                        /priv</pre></div>
    <p>The <span class="code">$SECOND_ROOT</span> and <span class="code">$THIRD_ROOT</span> are introduced as
      <span class="code">variables</span> in the call to the <span class="code">systools:make_script/2</span>
      function.</p>
    <h4>Disk-Less and/or Read-Only Clients</h4>
      
      <p>If a complete system consists of some disk-less and/or
        read-only client nodes, a <span class="code">clients</span> directory should be
        added to the <span class="code">$ROOT</span> directory. By a read-only node we
        mean a node with a read-only file system.</p>
      <p>The <span class="code">clients</span> directory should have one sub-directory
        per supported client node. The name of each client directory
        should be the name of the corresponding client node. As a
        minimum, each client directory should contain the <span class="code">bin</span> and
        <span class="code">releases</span> sub-directories. These directories are used to
        store information about installed releases and to appoint the
        current release to the client. Accordingly, the <span class="code">$ROOT</span>
        directory contains the following:</p>
      <div class="example"><pre>
$ROOT/...
    /clients/ClientName1/bin
                        /releases/Vsn
            /ClientName2/bin
                        /releases/Vsn
            ...
            /ClientNameN/bin
                        /releases/Vsn</pre></div>
      <p>This structure should be used if all clients are running
        the same type of Erlang machine. If there are clients running
        different types of Erlang machines, or on different operating
        systems, the <span class="code">clients</span> directory could be divided into one
        sub-directory per type of Erlang machine. Alternatively, you
        can set up one <span class="code">$ROOT</span> per type of machine. For each
        type, some of the directories specified for the <span class="code">$ROOT</span>
        directory should be included:</p>
      <div class="example"><pre>
$ROOT/...
    /clients/Type1/lib
                  /erts-EVsn
                  /bin
                  /ClientName1/bin
                              /releases/Vsn
                  /ClientName2/bin
                              /releases/Vsn
                  ...
                  /ClientNameN/bin
                              /releases/Vsn
            ...
            /TypeN/lib
                  /erts-EVsn
                  /bin
                  ...</pre></div>
      <p>With this structure, the root directory for clients of
        <span class="code">Type1</span> is <span class="code">$ROOT/clients/Type1</span>.</p>
    
  
</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2009 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-3045895-1";
urchinTracker();
</script> 
</body>
</html>
